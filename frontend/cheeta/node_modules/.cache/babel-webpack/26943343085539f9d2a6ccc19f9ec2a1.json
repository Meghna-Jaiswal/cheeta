{"ast":null,"code":"import _asyncToGenerator from \"/home/meghna/mogi/kube-mogi/cheeta/frontend/cheeta/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { moveItemInArray, transferArrayItem } from '@angular/cdk/drag-drop';\nimport { WarningDialog } from '../notifications/warning.component';\nlet KanbanComponent = class KanbanComponent {\n  constructor(cheetaTicketService, cheetaUserService, cheetaTagsService, dialog) {\n    this.cheetaTicketService = cheetaTicketService;\n    this.cheetaUserService = cheetaUserService;\n    this.cheetaTagsService = cheetaTagsService;\n    this.dialog = dialog;\n    this.backlog = [];\n    this.development = [];\n    this.testing = [];\n    this.done = [];\n    this.deployed = []; //filters option variables\n\n    this.projectName = \"\";\n    this.members = \"\";\n    this.priority = \"\";\n    this.state = \"\";\n    this.projectNameArr = []; //for members Filters\n\n    this.membersArr = {\n      developers: [],\n      testers: [],\n      others: []\n    };\n    this.isLoading = true;\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.isLoading = true;\n\n      if (localStorage.getItem('lastFilter') && localStorage.getItem('lastFilter') !== \"{}\") {\n        let filterOption = \"{}\";\n        filterOption = localStorage.getItem('lastFilter');\n        yield _this.getTickets(JSON.parse(filterOption));\n      } else {\n        yield _this.getTickets({});\n      }\n\n      yield _this.membersCategory();\n      let resProjects = yield _this.cheetaTagsService.getProjectsList();\n      if (resProjects && resProjects.length) _this.projectNameArr = resProjects;\n      _this.takeSub = _this.cheetaTicketService.getTicketUpdateListener().subscribe( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (data) {\n          yield _this.onApply();\n        });\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    })();\n  }\n\n  drop(event) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      if (event.previousContainer === event.container) {\n        moveItemInArray(event.container.data, event.previousIndex, event.currentIndex);\n      } else {\n        const t = _this2.transferValid(event.previousContainer.id, event.container.id);\n\n        if (!t) {\n          _this2.openWarningDialog('Not valid Movement');\n\n          return;\n        }\n\n        transferArrayItem(event.previousContainer.data, event.container.data, event.previousIndex, event.currentIndex);\n\n        _this2.autoAddUser(event.container.data[event.currentIndex]);\n\n        _this2.updateTicketStatus(event.container.data[event.currentIndex], {\n          prev: event.previousContainer.id,\n          new: event.container.id,\n          prevData: event.previousContainer.data,\n          newData: event.container.data,\n          prevIndex: event.previousIndex,\n          newIndex: event.currentIndex\n        });\n      }\n    })();\n  }\n\n  transferValid(prevState, newState) {\n    const stateType = ['backlog', 'development', 'testing', 'done', 'deployed'];\n\n    if (stateType.indexOf(newState) > stateType.indexOf(prevState) && stateType.indexOf(newState) == stateType.indexOf(prevState) + 1) {\n      // console.log(ticket)\n      return true;\n    }\n\n    if (stateType.indexOf(newState) < stateType.indexOf(prevState) && newState == \"backlog\") return true;\n    return false;\n  } // it will work on two conditions\n  // * onInIt\n  // * using filters\n\n\n  getTickets(filters) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this3.cheetaTicketService.getTickets(filters);\n      console.log(result);\n      if (result) _this3.isLoading = false;\n      _this3.backlog = [];\n      _this3.development = [];\n      _this3.testing = [];\n      _this3.deployed = [];\n      _this3.done = [];\n      yield result.forEach(i => {\n        if (i.state == 'backlog') _this3.backlog.unshift(i);\n        if (i.state == 'development') _this3.development.unshift(i);\n        if (i.state == 'testing') _this3.testing.unshift(i);\n        if (i.state == 'deployed') _this3.deployed.unshift(i);\n        if (i.state == 'done') _this3.done.unshift(i);\n      });\n    })();\n  }\n\n  loadPrevFilters() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      if (localStorage.getItem('lastFilter') && localStorage.getItem('lastFilter') !== \"{}\") {\n        let filterOption;\n        filterOption = localStorage.getItem('lastFilter');\n        filterOption = JSON.parse(filterOption);\n        yield _this4.getTickets(filterOption); // add filters to filters drop down\n\n        if (filterOption['members']) _this4.members = filterOption['members'][0];\n        if (filterOption['priority']) _this4.priority = filterOption['priority'][0];\n        if (filterOption['project']) _this4.projectName = filterOption['project'][0];\n        if (filterOption['state']) _this4.projectName = filterOption['state'][0];\n      } else {\n        yield _this4.getTickets({});\n      }\n    })();\n  }\n\n  updateTicketStatus(ticket, states) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      const changes = {\n        states: {\n          prev: states.prev,\n          new: states.new\n        },\n        user: yield _this5.getUserDets()\n      };\n\n      try {\n        let result = yield _this5.cheetaTicketService.updateTicketState(ticket, changes);\n        console.log(result);\n      } catch (err) {\n        transferArrayItem(states.newData, states.prevData, states.newIndex, states.prevIndex);\n\n        _this5.openWarningDialog('' + err);\n\n        return;\n      }\n    })();\n  }\n\n  onApply() {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      const filterOption = {};\n      if (_this6.members) filterOption['members'] = [_this6.members];\n      if (_this6.priority) filterOption['priority'] = [_this6.priority];\n      if (_this6.projectName) filterOption['project'] = [_this6.projectName];\n      if (_this6.state) filterOption['state'] = [_this6.state];\n      yield _this6.getTickets(filterOption);\n      localStorage.setItem('lastFilter', JSON.stringify(filterOption));\n    })();\n  }\n\n  openWarningDialog(warning) {\n    const dialogRef = this.dialog.open(WarningDialog, {\n      data: warning\n    });\n  }\n\n  autoAddUser(ticket) {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      let flag = ticket.members.filter(m => {\n        if (m.userId == localStorage.getItem('userId')) return m;\n      });\n\n      if (!flag.length) {\n        let members = [...ticket.members, yield _this7.getUserDets()];\n        yield _this7.cheetaTicketService.updateTicket(ticket._id, {\n          members\n        });\n      }\n    })();\n  }\n\n  membersCategory() {\n    var _this8 = this;\n\n    return _asyncToGenerator(function* () {\n      let resMembers = yield _this8.cheetaUserService.getUsersList();\n      resMembers.forEach(a => {\n        if (a.type == 'software-developer') _this8.membersArr.developers.push(a);else if (a.type == 'quality-analyst') _this8.membersArr.testers.push(a);else _this8.membersArr.others.push(a);\n      });\n    })();\n  }\n\n  getUserDets() {\n    var _this9 = this;\n\n    return _asyncToGenerator(function* () {\n      let userDets = yield _this9.cheetaUserService.getUserData();\n      if (userDets.data) return {\n        email: userDets.data.name,\n        type: userDets.data.type,\n        userId: userDets.data._id,\n        profilePic: userDets.data.profilePic ? userDets.data.profilePic : ''\n      };\n      return {};\n    })();\n  }\n\n  ngOnDestroy() {\n    this.takeSub.unsubscribe();\n  }\n\n};\nKanbanComponent = __decorate([Component({\n  selector: 'app-kanban',\n  templateUrl: './kanban.component.html',\n  styleUrls: ['./kanban.component.scss']\n})], KanbanComponent);\nexport { KanbanComponent };","map":{"version":3,"sources":["/home/meghna/mogi/kube-mogi/cheeta/frontend/cheeta/src/app/pages/kanban/kanban.component.ts"],"names":["__decorate","Component","moveItemInArray","transferArrayItem","WarningDialog","KanbanComponent","constructor","cheetaTicketService","cheetaUserService","cheetaTagsService","dialog","backlog","development","testing","done","deployed","projectName","members","priority","state","projectNameArr","membersArr","developers","testers","others","isLoading","ngOnInit","localStorage","getItem","filterOption","getTickets","JSON","parse","membersCategory","resProjects","getProjectsList","length","takeSub","getTicketUpdateListener","subscribe","data","onApply","drop","event","previousContainer","container","previousIndex","currentIndex","t","transferValid","id","openWarningDialog","autoAddUser","updateTicketStatus","prev","new","prevData","newData","prevIndex","newIndex","prevState","newState","stateType","indexOf","filters","result","console","log","forEach","i","unshift","loadPrevFilters","ticket","states","changes","user","getUserDets","updateTicketState","err","setItem","stringify","warning","dialogRef","open","flag","filter","m","userId","updateTicket","_id","resMembers","getUsersList","a","type","push","userDets","getUserData","email","name","profilePic","ngOnDestroy","unsubscribe","selector","templateUrl","styleUrls"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { moveItemInArray, transferArrayItem } from '@angular/cdk/drag-drop';\nimport { WarningDialog } from '../notifications/warning.component';\nlet KanbanComponent = class KanbanComponent {\n    constructor(cheetaTicketService, cheetaUserService, cheetaTagsService, dialog) {\n        this.cheetaTicketService = cheetaTicketService;\n        this.cheetaUserService = cheetaUserService;\n        this.cheetaTagsService = cheetaTagsService;\n        this.dialog = dialog;\n        this.backlog = [];\n        this.development = [];\n        this.testing = [];\n        this.done = [];\n        this.deployed = [];\n        //filters option variables\n        this.projectName = \"\";\n        this.members = \"\";\n        this.priority = \"\";\n        this.state = \"\";\n        this.projectNameArr = [];\n        //for members Filters\n        this.membersArr = {\n            developers: [],\n            testers: [],\n            others: []\n        };\n        this.isLoading = true;\n    }\n    async ngOnInit() {\n        this.isLoading = true;\n        if (localStorage.getItem('lastFilter') &&\n            localStorage.getItem('lastFilter') !== \"{}\") {\n            let filterOption = \"{}\";\n            filterOption = localStorage.getItem('lastFilter');\n            await this.getTickets(JSON.parse(filterOption));\n        }\n        else {\n            await this.getTickets({});\n        }\n        await this.membersCategory();\n        let resProjects = await this.cheetaTagsService.getProjectsList();\n        if (resProjects && resProjects.length)\n            this.projectNameArr = resProjects;\n        this.takeSub = this.cheetaTicketService.getTicketUpdateListener()\n            .subscribe(async (data) => {\n            await this.onApply();\n        });\n    }\n    async drop(event) {\n        if (event.previousContainer === event.container) {\n            moveItemInArray(event.container.data, event.previousIndex, event.currentIndex);\n        }\n        else {\n            const t = this.transferValid(event.previousContainer.id, event.container.id);\n            if (!t) {\n                this.openWarningDialog('Not valid Movement');\n                return;\n            }\n            transferArrayItem(event.previousContainer.data, event.container.data, event.previousIndex, event.currentIndex);\n            this.autoAddUser(event.container.data[event.currentIndex]);\n            this.updateTicketStatus(event.container.data[event.currentIndex], {\n                prev: event.previousContainer.id,\n                new: event.container.id,\n                prevData: event.previousContainer.data,\n                newData: event.container.data,\n                prevIndex: event.previousIndex,\n                newIndex: event.currentIndex\n            });\n        }\n    }\n    transferValid(prevState, newState) {\n        const stateType = ['backlog', 'development', 'testing', 'done', 'deployed'];\n        if (stateType.indexOf(newState) > stateType.indexOf(prevState)\n            && stateType.indexOf(newState) == stateType.indexOf(prevState) + 1) {\n            // console.log(ticket)\n            return true;\n        }\n        if (stateType.indexOf(newState) < stateType.indexOf(prevState)\n            && newState == \"backlog\")\n            return true;\n        return false;\n    }\n    // it will work on two conditions\n    // * onInIt\n    // * using filters\n    async getTickets(filters) {\n        let result = await this.cheetaTicketService.getTickets(filters);\n        console.log(result);\n        if (result)\n            this.isLoading = false;\n        this.backlog = [];\n        this.development = [];\n        this.testing = [];\n        this.deployed = [];\n        this.done = [];\n        await result.forEach((i) => {\n            if (i.state == 'backlog')\n                this.backlog.unshift(i);\n            if (i.state == 'development')\n                this.development.unshift(i);\n            if (i.state == 'testing')\n                this.testing.unshift(i);\n            if (i.state == 'deployed')\n                this.deployed.unshift(i);\n            if (i.state == 'done')\n                this.done.unshift(i);\n        });\n    }\n    async loadPrevFilters() {\n        if (localStorage.getItem('lastFilter') &&\n            localStorage.getItem('lastFilter') !== \"{}\") {\n            let filterOption;\n            filterOption = localStorage.getItem('lastFilter');\n            filterOption = JSON.parse(filterOption);\n            await this.getTickets(filterOption);\n            // add filters to filters drop down\n            if (filterOption['members'])\n                this.members = filterOption['members'][0];\n            if (filterOption['priority'])\n                this.priority = filterOption['priority'][0];\n            if (filterOption['project'])\n                this.projectName = filterOption['project'][0];\n            if (filterOption['state'])\n                this.projectName = filterOption['state'][0];\n        }\n        else {\n            await this.getTickets({});\n        }\n    }\n    async updateTicketStatus(ticket, states) {\n        const changes = {\n            states: {\n                prev: states.prev,\n                new: states.new\n            },\n            user: await this.getUserDets()\n        };\n        try {\n            let result = await this.cheetaTicketService.updateTicketState(ticket, changes);\n            console.log(result);\n        }\n        catch (err) {\n            transferArrayItem(states.newData, states.prevData, states.newIndex, states.prevIndex);\n            this.openWarningDialog('' + err);\n            return;\n        }\n    }\n    async onApply() {\n        const filterOption = {};\n        if (this.members)\n            filterOption['members'] = [this.members];\n        if (this.priority)\n            filterOption['priority'] = [this.priority];\n        if (this.projectName)\n            filterOption['project'] = [this.projectName];\n        if (this.state)\n            filterOption['state'] = [this.state];\n        await this.getTickets(filterOption);\n        localStorage.setItem('lastFilter', JSON.stringify(filterOption));\n    }\n    openWarningDialog(warning) {\n        const dialogRef = this.dialog.open(WarningDialog, {\n            data: warning,\n        });\n    }\n    async autoAddUser(ticket) {\n        let flag = ticket.members.filter((m) => {\n            if (m.userId == localStorage.getItem('userId'))\n                return m;\n        });\n        if (!flag.length) {\n            let members = [...ticket.members, await this.getUserDets()];\n            await this.cheetaTicketService.updateTicket(ticket._id, { members });\n        }\n    }\n    async membersCategory() {\n        let resMembers = await this.cheetaUserService.getUsersList();\n        resMembers.forEach((a) => {\n            if (a.type == 'software-developer')\n                this.membersArr.developers.push(a);\n            else if (a.type == 'quality-analyst')\n                this.membersArr.testers.push(a);\n            else\n                this.membersArr.others.push(a);\n        });\n    }\n    async getUserDets() {\n        let userDets = await this.cheetaUserService.getUserData();\n        if (userDets.data)\n            return {\n                email: userDets.data.name,\n                type: userDets.data.type,\n                userId: userDets.data._id,\n                profilePic: userDets.data.profilePic ? userDets.data.profilePic : ''\n            };\n        return {};\n    }\n    ngOnDestroy() {\n        this.takeSub.unsubscribe();\n    }\n};\nKanbanComponent = __decorate([\n    Component({\n        selector: 'app-kanban',\n        templateUrl: './kanban.component.html',\n        styleUrls: ['./kanban.component.scss']\n    })\n], KanbanComponent);\nexport { KanbanComponent };\n"]},"metadata":{},"sourceType":"module"}