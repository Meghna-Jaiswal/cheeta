{"ast":null,"code":"import _asyncToGenerator from \"/home/meghna/mogi/kube-mogi/cheeta/frontend/cheeta/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { Subject } from \"rxjs\";\nimport { environment } from \"src/environments/environment\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nconst usersURL = environment.cheetaUserURL;\nexport class AuthService {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.token = null;\n    this.tokenTimer = null;\n    this.authStatusListener = new Subject();\n    this.authStatus = false;\n  }\n\n  getToken() {\n    return this.token;\n  }\n\n  getAuthStatusListener() {\n    return this.authStatusListener.asObservable();\n  }\n\n  getAuthStatus() {\n    return this.authStatus;\n  }\n\n  register(regData) {\n    console.log(\"api url\", usersURL);\n    this.http.post(usersURL, regData).subscribe(resp => {\n      console.log(\"lolz ::: new resopnse\", resp);\n      console.log(\"userId::\", resp.data.userId);\n\n      if (resp && resp.status && resp.status.code == 200) {\n        this.router.navigate(['/auth/verifyOTP'], {\n          queryParams: {\n            email: resp.data.email,\n            userId: resp.data.userid\n          }\n        });\n      }\n    }, error => {\n      console.log(error);\n    });\n  }\n\n  verifyOtp(otpData) {\n    console.log('verfying otp', otpData);\n    this.http.post(usersURL + \"/verifyOTP\", otpData).subscribe(resp => {\n      console.log(\"lolz ::: new resopnse\", resp);\n      if (resp && resp.status && resp.status.code == 200) this.router.navigate(['/auth/login']);\n    }, error => {\n      console.log(error);\n    });\n  }\n\n  autoAuthUser() {\n    const authInfo = this.getAuthData();\n\n    if (authInfo) {\n      let expiresIn = new Date(authInfo.expirationDate).getTime() - new Date().getTime();\n\n      if (expiresIn > 0) {\n        this.token = authInfo.token;\n        this.authStatus = true;\n        this.tokenTimer = setTimeout(() => {\n          this.logout();\n        }, expiresIn);\n        this.authStatusListener.next(true);\n      }\n    }\n  }\n\n  login(form) {\n    var _this = this;\n\n    console.log(\"api url :: \", usersURL);\n    this.http.post(usersURL + 'login', form).subscribe( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (resp) {\n        if (resp) {\n          console.log('login res ::', resp);\n          _this.token = resp.data.token;\n\n          if (_this.token != null) {\n            let expirationDate = _this.getExpirationDate(resp.data.expiresIn);\n\n            _this.saveAuthData(resp.data, expirationDate);\n\n            _this.tokenTimer = setTimeout(() => {\n              _this.logout();\n            }, resp.data.expiresIn * 1000);\n\n            _this.authStatusListener.next(true);\n\n            _this.authStatus = true;\n\n            _this.router.navigate(['']);\n          }\n        }\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }(), err => {\n      console.log(err); // console.log(\"geetaaa\", err);\n      // this.authStatusListener.next(false);\n    });\n  }\n\n  logout() {\n    this.token = null;\n    this.authStatus = false;\n    this.authStatusListener.next(false);\n    clearTimeout(this.tokenTimer);\n    localStorage.clear();\n    this.router.navigate(['/auth/login']);\n  }\n\n  saveAuthData(obj, expirationDate) {\n    localStorage.setItem('expirationDate', expirationDate.toISOString());\n    localStorage.setItem('mobile', obj.mobile);\n    localStorage.setItem('token', obj.token);\n    localStorage.setItem('email', obj.email);\n    localStorage.setItem('userId', obj.userId);\n  }\n\n  getAuthData() {\n    if (localStorage.getItem(\"token\") && localStorage.getItem(\"expirationDate\")) return {\n      token: localStorage.getItem(\"token\"),\n      expirationDate: localStorage.getItem(\"expirationDate\")\n    };\n    return false;\n  }\n\n  getExpirationDate(expiresIn) {\n    let now = new Date();\n    return new Date(now.getTime() + expiresIn * 1000);\n  }\n\n}\n\nAuthService.ɵfac = function AuthService_Factory(t) {\n  return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n};\n\nAuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthService,\n  factory: AuthService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["/home/meghna/mogi/kube-mogi/cheeta/frontend/cheeta/src/app/pages/auth/auth.service.ts"],"names":["Subject","environment","i0","i1","i2","usersURL","cheetaUserURL","AuthService","constructor","http","router","token","tokenTimer","authStatusListener","authStatus","getToken","getAuthStatusListener","asObservable","getAuthStatus","register","regData","console","log","post","subscribe","resp","data","userId","status","code","navigate","queryParams","email","userid","error","verifyOtp","otpData","autoAuthUser","authInfo","getAuthData","expiresIn","Date","expirationDate","getTime","setTimeout","logout","next","login","form","getExpirationDate","saveAuthData","err","clearTimeout","localStorage","clear","obj","setItem","toISOString","mobile","getItem","now","ɵfac","AuthService_Factory","t","ɵɵinject","HttpClient","Router","ɵprov","ɵɵdefineInjectable","factory","providedIn"],"mappings":"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","sourcesContent":["import { Subject } from \"rxjs\";\nimport { environment } from \"src/environments/environment\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nconst usersURL = environment.cheetaUserURL;\nexport class AuthService {\n    constructor(http, router) {\n        this.http = http;\n        this.router = router;\n        this.token = null;\n        this.tokenTimer = null;\n        this.authStatusListener = new Subject();\n        this.authStatus = false;\n    }\n    getToken() {\n        return this.token;\n    }\n    getAuthStatusListener() {\n        return this.authStatusListener.asObservable();\n    }\n    getAuthStatus() {\n        return this.authStatus;\n    }\n    register(regData) {\n        console.log(\"api url\", usersURL);\n        this.http\n            .post(usersURL, regData)\n            .subscribe((resp) => {\n            console.log(\"lolz ::: new resopnse\", resp);\n            console.log(\"userId::\", resp.data.userId);\n            if (resp && resp.status && resp.status.code == 200) {\n                this.router.navigate(['/auth/verifyOTP'], { queryParams: { email: resp.data.email, userId: resp.data.userid } });\n            }\n        }, error => {\n            console.log(error);\n        });\n    }\n    verifyOtp(otpData) {\n        console.log('verfying otp', otpData);\n        this.http\n            .post(usersURL + \"/verifyOTP\", otpData)\n            .subscribe((resp) => {\n            console.log(\"lolz ::: new resopnse\", resp);\n            if (resp && resp.status && resp.status.code == 200)\n                this.router.navigate(['/auth/login']);\n        }, error => {\n            console.log(error);\n        });\n    }\n    autoAuthUser() {\n        const authInfo = this.getAuthData();\n        if (authInfo) {\n            let expiresIn = new Date(authInfo.expirationDate).getTime() - (new Date()).getTime();\n            if (expiresIn > 0) {\n                this.token = authInfo.token;\n                this.authStatus = true;\n                this.tokenTimer = setTimeout(() => {\n                    this.logout();\n                }, expiresIn);\n                this.authStatusListener.next(true);\n            }\n        }\n    }\n    login(form) {\n        console.log(\"api url :: \", usersURL);\n        this.http\n            .post(usersURL + 'login', form)\n            .subscribe(async (resp) => {\n            if (resp) {\n                console.log('login res ::', resp);\n                this.token = resp.data.token;\n                if (this.token != null) {\n                    let expirationDate = this.getExpirationDate(resp.data.expiresIn);\n                    this.saveAuthData(resp.data, expirationDate);\n                    this.tokenTimer = setTimeout(() => {\n                        this.logout();\n                    }, resp.data.expiresIn * 1000);\n                    this.authStatusListener.next(true);\n                    this.authStatus = true;\n                    this.router.navigate(['']);\n                }\n            }\n        }, err => {\n            console.log(err);\n            // console.log(\"geetaaa\", err);\n            // this.authStatusListener.next(false);\n        });\n    }\n    logout() {\n        this.token = null;\n        this.authStatus = false;\n        this.authStatusListener.next(false);\n        clearTimeout(this.tokenTimer);\n        localStorage.clear();\n        this.router.navigate(['/auth/login']);\n    }\n    saveAuthData(obj, expirationDate) {\n        localStorage.setItem('expirationDate', expirationDate.toISOString());\n        localStorage.setItem('mobile', obj.mobile);\n        localStorage.setItem('token', obj.token);\n        localStorage.setItem('email', obj.email);\n        localStorage.setItem('userId', obj.userId);\n    }\n    getAuthData() {\n        if (localStorage.getItem(\"token\") &&\n            localStorage.getItem(\"expirationDate\"))\n            return {\n                token: localStorage.getItem(\"token\"),\n                expirationDate: localStorage.getItem(\"expirationDate\")\n            };\n        return false;\n    }\n    getExpirationDate(expiresIn) {\n        let now = new Date();\n        return new Date(now.getTime() + expiresIn * 1000);\n    }\n}\nAuthService.ɵfac = function AuthService_Factory(t) { return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router)); };\nAuthService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: AuthService, factory: AuthService.ɵfac, providedIn: 'root' });\n"]},"metadata":{},"sourceType":"module"}